var Cve = /** @class */ (function () {
    function Cve() {
    }
    return Cve;
}());
var SEVERITY_CLASS = {
    "": "severity_unknown",
    "low": "severity_low",
    "medium": "severity_medium",
    "high": "severity_high",
};
/**
 * Escape html to prevent xss.
 */
function escapeHtml(htmlStr) {
    return htmlStr.replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
}
function getListResults(response) {
    var html = "<div class='list-group'>";
    for (var item in response) {
        var cve = response[item];
        var severity_class = SEVERITY_CLASS[cve.severity ? cve.severity.toLocaleLowerCase() : ""];
        if (!severity_class) {
            severity_class = "";
        }
        html += "\n\t\t<div class='list-group-item ".concat(severity_class, "'>\n\t\t\t<div><span class='cve_id'>").concat(escapeHtml(cve.cveId), "</span> [").concat(escapeHtml(cve.source), "] \n\t\t\t\t<span class='cve_published'>").concat(new Date(cve.published).toLocaleDateString(), "</span></div>\n\t\t\t<div><span class='cve_description'>").concat(escapeHtml(cve.description), "</span></div>\n\t\t</div>\n\t\t");
    }
    html += "</div>";
    return html;
}
/**
 * Retrieve cve's matching user search input.
 */
function searchCve() {
    var val = $(".input_search").val();
    var data = {
        search: val
    };
    var url = "http://localhost:8080/cve/search";
    $.ajax({
        url: url,
        type: "GET",
        data: data,
        success: function (response, status, jqxhr) {
            var html = getListResults(response);
            $(".search_results").html(html);
        },
        error: function (response) {
            console.log(response);
        },
        dataType: "json"
    });
}
/**
 * Retrieve top cves on a schedule.
 */
function checkTopCves() {
    var url = "http://localhost:8080/cve/recent";
    console.log("checking top cve's");
    $.ajax({
        url: url,
        type: "GET",
        success: function (response, status, jqxhr) {
            var html = getListResults(response);
            $(".top_cves").html(html);
        },
        error: function (response) {
            console.log(response);
        },
        dataType: "json"
    });
    setTimeout(checkTopCves, 1000 * 30);
}
$(function () {
    $(".input_search").on("keyup touchend", function () {
        searchCve();
    });
    checkTopCves();
});
